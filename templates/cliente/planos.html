{% extends "base.html" %}
{% block title %}Planos Mensais - {{ barbearia.nome }}{% endblock %}

{% block content %}
<style>
:root {
    --cor-primaria: {{ barbearia.cor_primaria or '#8b5cf6' }};
    --cor-secundaria: {{ barbearia.cor_secundaria or '#A78BFA' }};
    --cor-texto: {{ barbearia.cor_texto or '#1f2937' }};
}
</style>


<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        color: var(--cor-texto);
        font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        min-height: 100vh;
    }

    /* Navbar moved to shared partial */

    .btn {
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: var(--cor-primaria);
        color: #ffffff;
    }

    .btn-primary:hover {
        background: #3a8eef;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: transparent;
        color: var(--cor-texto);
        border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .btn-secondary:hover {
        background: rgba(139, 92, 246, 0.1);
    }

    .btn-danger {
        background: #ff4a4a;
        color: #ffffff;
    }

    .btn-danger:hover {
        background: #ef3a3a;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }


    .page-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        letter-spacing: -0.5px;
        color: var(--cor-texto);
    }

    /* For√ßar override do estilo global de h1 (gradient e uppercase) */
    h1.page-title {
        background: none !important;
        -webkit-background-clip: initial !important;
        -webkit-text-fill-color: var(--cor-texto) !important;
        color: var(--cor-texto) !important;
        text-transform: none !important; /* manter capitaliza√ß√£o do conte√∫do */
        font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif !important;
        font-weight: 800 !important;
    }

    h1.page-title::after {
        display: none !important; /* remover linha decorativa do h1 global */
    }

    .page-subtitle {
        font-size: 1.2rem;
        color: rgba(31, 41, 55, 0.7);
    }

    .assinatura-ativa {
        background: rgba(139, 92, 246, 0.1);
        border: 2px solid var(--cor-primaria);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 3rem;
        text-align: center;
    }

    .assinatura-ativa h3 {
        color: var(--cor-primaria);
        margin-bottom: 1rem;
        font-size: 1.8rem;
    }

    .assinatura-info {
        display: flex;
        justify-content: center;
        gap: 3rem;
        margin: 1.5rem 0;
        flex-wrap: wrap;
    }

    .assinatura-stat {
        text-align: center;
    }

    .assinatura-stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--cor-primaria);
    }

    .assinatura-stat-label {
        color: rgba(31, 41, 55, 0.7);
        font-size: 1rem;
    }

    .planos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

    .plano-card {
        background: rgba(139, 92, 246, 0.05);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 20px;
        padding: 2.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .plano-card:hover {
        transform: translateY(-5px);
        border-color: var(--cor-primaria);
        box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
    }

    .plano-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .plano-nome {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--cor-primaria);
        margin-bottom: 0.5rem;
    }

    .plano-preco {
        font-size: 3rem;
        font-weight: 800;
        color: var(--cor-texto);
        margin: 1rem 0;
    }

    .plano-preco-label {
        font-size: 1rem;
        color: rgba(31, 41, 55, 0.6);
    }

    .plano-atendimentos {
        background: rgba(139, 92, 246, 0.1);
        padding: 1rem;
        border-radius: 10px;
        text-align: center;
        margin: 1.5rem 0;
        font-weight: 600;
    }

    .plano-descricao {
        color: rgba(31, 41, 55, 0.8);
        line-height: 1.6;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .plano-beneficios {
        margin: 1.5rem 0;
    }

    .plano-beneficios-title {
        font-weight: 700;
        color: var(--cor-primaria);
        margin-bottom: 1rem;
    }

    .plano-beneficios-list {
        list-style: none;
        padding: 0;
    }

    .plano-beneficios-list li {
        padding: 0.8rem 0;
        border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        color: rgba(31, 41, 55, 0.9);
    }

    .plano-beneficios-list li:before {
        content: "‚úì ";
        color: var(--cor-primaria);
        font-weight: bold;
        margin-right: 0.5rem;
    }

    .plano-actions {
        margin-top: 2rem;
    }

    .alert {
        padding: 1rem 1.5rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
    }

    .alert-success {
        background: rgba(46, 213, 115, 0.1);
        border: 1px solid #2ed573;
        color: #2ed573;
    }

    .alert-warning {
        background: rgba(255, 190, 11, 0.1);
        border: 1px solid #ffbe0b;
        color: #ffbe0b;
    }

    .alert-error {
        background: rgba(255, 71, 87, 0.1);
        border: 1px solid #ff4757;
        color: #ff4757;
    }

    .alert-info {
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid var(--cor-primaria);
        color: var(--cor-primaria);
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: rgba(31, 41, 55, 0.6);
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
        .navbar-content {
            flex-direction: column;
            gap: 1rem;
        }

        .navbar-menu {
            flex-direction: column;
            width: 100%;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .page-title {
            font-size: 2rem;
        }

        .planos-grid {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1.5rem;
            padding-bottom: 1rem;
            -webkit-overflow-scrolling: touch;
        }

        .planos-grid::-webkit-scrollbar {
            height: 8px;
        }

        .planos-grid::-webkit-scrollbar-track {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
        }

        .planos-grid::-webkit-scrollbar-thumb {
            background: var(--cor-primaria);
            border-radius: 10px;
        }

        .plano-card {
            min-width: 300px;
            max-width: 300px;
            scroll-snap-align: start;
        }

        .assinatura-info {
            flex-direction: column;
            gap: 1.5rem;
        }
    }
</style>

<!-- Container Principal -->
<div class="container">
    <!-- Header -->
    <div class="page-header">
        <h1 class="page-title">
            üíé Planos mensais
        </h1>
        <p class="page-subtitle">
            Escolha o plano ideal para voc√™ e economize em seus atendimentos
        </p>
    </div>

    <!-- Mensagens Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Assinatura Ativa -->
    {% if assinatura_ativa %}
    <div class="assinatura-ativa">
        <h3>‚ú® Voc√™ tem um plano ativo!</h3>
        <p style="color: rgba(31, 41, 55, 0.8); font-size: 1.1rem; margin-bottom: 1rem;">
            {{ assinatura_ativa.plano.nome }}
        </p>
        
        <div class="assinatura-info">
            <div class="assinatura-stat">
                <div class="assinatura-stat-number">{{ assinatura_ativa.atendimentos_restantes }}</div>
                <div class="assinatura-stat-label">Atendimentos restantes</div>
            </div>
            <div class="assinatura-stat">
                <div class="assinatura-stat-number">R$ {{ "%.2f"|format(assinatura_ativa.plano.preco) }}</div>
                <div class="assinatura-stat-label">Valor do plano</div>
            </div>
            {% if assinatura_ativa.data_renovacao %}
            <div class="assinatura-stat">
                <div class="assinatura-stat-number">{{ assinatura_ativa.data_renovacao.strftime('%d/%m') }}</div>
                <div class="assinatura-stat-label">Pr√≥xima renova√ß√£o</div>
            </div>
            {% endif %}
        </div>

        <form method="POST" action="{{ url_for('cancelar_assinatura', slug=barbearia.slug, assinatura_uuid=assinatura_ativa.uuid) }}" style="margin-top: 2rem;" onsubmit="return confirm('Tem certeza que deseja cancelar sua assinatura?')" data-loading="true" data-loading-text="Cancelando assinatura..." data-loading-subtext="Processando cancelamento">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="btn btn-danger">
                ‚ùå Cancelar assinatura
            </button>
        </form>
    </div>
    {% endif %}

    <!-- Grid de Planos -->
    {% if planos %}
    <div class="planos-grid">
        {% for plano in planos %}
        <div class="plano-card">
            <div class="plano-header">
                <div class="plano-nome">{{ plano.nome }}</div>
                <div class="plano-preco">
                    R$ {{ "%.2f"|format(plano.preco) }}
                </div>
                <div class="plano-preco-label">por m√™s</div>
            </div>

            <div class="plano-atendimentos">
                üìÖ {{ plano.atendimentos_mes }} atendimento{{ 's' if plano.atendimentos_mes > 1 else '' }} por m√™s
            </div>

            {% if plano.descricao %}
            <div class="plano-descricao">
                {{ plano.descricao }}
            </div>
            {% endif %}

            {% set beneficios = plano.get_beneficios() %}
            {% if beneficios %}
            <div class="plano-beneficios">
                <div class="plano-beneficios-title">‚ú® Benef√≠cios inclusos:</div>
                <ul class="plano-beneficios-list">
                    {% for beneficio in beneficios %}
                    <li>{{ beneficio }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if not assinatura_ativa %}
            <div class="plano-actions">
                {% if barbearia.telefone %}
                    {% set phone = barbearia.telefone|replace(' ','')|replace('+','')|replace('(','')|replace(')','')|replace('-','') %}
                    {% set msg = ('Ol√°, gostaria de consultar sobre o plano ' ~ plano.nome) %}
                    {% set msg_enc = msg|replace(' ', '%20') %}
                    <a href="https://wa.me/{{ phone }}?text={{ msg_enc }}" target="_blank" rel="noopener" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        üí¨ Consultar com o barbeiro
                    </a>
                {% else %}
                    <button type="button" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        üí¨ Consultar com o barbeiro
                    </button>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}
