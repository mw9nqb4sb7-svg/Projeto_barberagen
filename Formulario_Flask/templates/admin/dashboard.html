<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - {{ barbearia.nome }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
<!-- Navbar Admin -->
<nav class="navbar">
    <div class="navbar-content">
        <div class="navbar-brand">
            {% set nome_parts = barbearia.nome.split() %}
            {% if nome_parts|length >= 2 %}
                <span style="color: #ffffff;">{{ nome_parts[0] }} {{ nome_parts[1] }}</span><span style="color: #4a9eff;">{{ ' '.join(nome_parts[2:]) if nome_parts|length > 2 else '' }}</span>
            {% else %}
                <span style="color: #ffffff;">{{ barbearia.nome }}</span>
            {% endif %}
        </div>
        
        <!-- BotÃ£o Hamburguer (Mobile) -->
        <button id="mobileMenuBtn" onclick="toggleMobileMenu()">â˜°</button>
        
        <!-- Menu Desktop -->
        <div id="desktopMenu" class="navbar-menu">
            <a href="{{ url_for('dashboard', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ  DASHBOARD
            </a>
            <a href="{{ url_for('admin_agendamentos_slug', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ“… AGENDAMENTOS
            </a>
            <a href="{{ url_for('admin_faturamento', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ’° FATURAMENTO
            </a>
            <a href="{{ url_for('admin_despesas', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ’³ DESPESAS
            </a>
            <a href="{{ url_for('admin_planos_ativos', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ“‹ PLANOS
            </a>
            <a href="{{ url_for('admin_clientes', slug=barbearia.slug) }}" class="btn btn-secondary">
                ğŸ‘¥ CLIENTES
            </a>
            <a href="{{ url_for('servicos', slug=barbearia.slug) }}" class="btn btn-secondary">
                âœ‚ï¸ SERVIÃ‡OS
            </a>
            <a href="{{ url_for('logout', slug=barbearia.slug) }}" class="btn btn-secondary" style="background: rgba(255, 59, 48, 0.1); color: #ff3b30; border: 1px solid rgba(255, 59, 48, 0.3);">
                ğŸšª SAIR
            </a>
        </div>
    </div>
    
    <!-- Menu Mobile (Dropdown) -->
    <div id="mobileMenu" style="display: none; background: rgba(0, 0, 0, 0.98); border-top: 1px solid rgba(74, 158, 255, 0.2); padding: 1rem; margin-top: 1rem;">
        <div style="display: flex; flex-direction: column; gap: 0.75rem; max-width: 1600px; margin: 0 auto;">
            <a href="{{ url_for('dashboard', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ  DASHBOARD
            </a>
            <a href="{{ url_for('admin_agendamentos_slug', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ“… AGENDAMENTOS
            </a>
            <a href="{{ url_for('admin_faturamento', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ’° FATURAMENTO
            </a>
            <a href="{{ url_for('admin_despesas', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ’³ DESPESAS
            </a>
            <a href="{{ url_for('admin_planos_ativos', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ“‹ PLANOS
            </a>
            <a href="{{ url_for('admin_clientes', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                ğŸ‘¥ CLIENTES
            </a>
            <a href="{{ url_for('servicos', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem;">
                âœ‚ï¸ SERVIÃ‡OS
            </a>
            <a href="{{ url_for('logout', slug=barbearia.slug) }}" class="btn btn-secondary" style="width: 100%; justify-content: center; font-size: 1rem; padding: 1rem; background: rgba(255, 59, 48, 0.1); color: #ff3b30; border: 1px solid rgba(255, 59, 48, 0.3);">
                ğŸšª SAIR
            </a>
        </div>
    </div>
</nav>

<!-- v3.0 - Modernizado com Plus Jakarta Sans e #4a9eff -->
<style>
    * {
        font-family: 'Plus Jakarta Sans', sans-serif;
        letter-spacing: -0.5px;
        box-sizing: border-box;
    }

    .navbar {
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(13, 13, 13, 0.98) 100%);
        border-bottom: 3px solid #4a9eff;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        padding: 1.5rem 2rem;
    }

    .navbar-content {
        max-width: 1600px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .navbar-brand {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .navbar-menu {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .btn {
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
        cursor: pointer;
    }

    .btn-primary {
        background: #4a9eff;
        color: #000000;
    }

    .btn-primary:hover {
        background: #3a8eef;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: transparent;
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    #mobileMenuBtn {
        display: none;
        background: rgba(74, 158, 255, 0.1);
        border: 1px solid rgba(74, 158, 255, 0.3);
        color: #4a9eff;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.5rem;
        line-height: 1;
    }
    
    html, body {
        max-width: 100vw;
        width: 100%;
        position: relative;
        margin: 0;
        padding: 0;
        -webkit-overflow-scrolling: touch; /* Melhora scroll no iOS */
        overscroll-behavior: none; /* Previne bounce effect */
    }
    
    body {
        background: #000;
        color: #fff;
        padding-top: 120px; /* EspaÃ§o para navbar fixed */
    }
    
    /* Mobile adjustments */
    @media (max-width: 768px) {
        body {
            padding-top: 140px; /* Mais espaÃ§o para navbar mobile */
        }
    }
    
    /* Menu Mobile Responsivo */
    #mobileMenu {
        transition: all 0.3s ease;
    }
    
    @media (max-width: 768px) {
        #mobileMenuBtn {
            display: block !important;
        }
        
        #desktopMenu {
            display: none !important;
        }
    }
    
    @media (min-width: 769px) {
        #mobileMenu {
            display: none !important;
        }
    }
    
    /* Estilos responsivos para o dashboard */
    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .notification-bell {
        position: relative;
        cursor: pointer;
        padding: 10px;
        background: rgba(59, 130, 246, 0.1);
        border-radius: 50%;
        transition: all 0.3s ease;
    }
    
    .notification-bell:hover {
        background: rgba(59, 130, 246, 0.2);
        transform: scale(1.1);
    }
    
    .badge-notification {
        position: absolute;
        top: 0;
        right: 0;
        background: #ef4444;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 0.7em;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    /* Estilos para filtros */
    .filtro-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .filtro-btn.ativo {
        background: #3b82f6 !important;
        color: white !important;
        border-color: #3b82f6 !important;
    }
    
    #buscaCliente:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    #filtroStatus:focus {
        outline: none;
        border-color: #3b82f6;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
        max-width: 1100px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .stat-card {
        padding: 20px;
        border-radius: 12px;
        color: white;
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.2) !important;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255,255,255,0.1);
        transform: rotate(45deg);
        transition: all 0.5s ease;
    }
    
    .stat-card:hover::before {
        right: -100%;
    }
    
    .stat-card a {
        color: white !important;
        opacity: 0.9;
        text-decoration: none;
        font-size: 0.85em;
        transition: opacity 0.3s;
        position: relative;
        z-index: 1;
        margin-top: auto;
    }
    
    .stat-card a:hover {
        opacity: 1;
        text-decoration: underline;
    }
    
    .stat-card > div:first-child {
        font-size: 0.85em;
        opacity: 0.9;
        margin-bottom: 8px;
    }
    
    .stat-card > div:nth-child(2) {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
    }
    
    #notificationPanel {
        position: fixed;
        top: 80px;
        right: 20px;
        width: 350px;
        max-width: calc(100vw - 40px);
        max-height: 400px;
        overflow-y: auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        z-index: 1000;
        padding: 20px;
        animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .agendamento-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 12px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }
    
    .agendamento-card:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    /* Responsivo para cards inline */
    @media (max-width: 968px) {
        * {
            max-width: 100vw;
        }
        
        nav > div {
            flex-wrap: wrap !important;
            padding: 1rem !important;
        }
        
        nav > div > div:last-child {
            gap: 0.5rem !important;
            justify-content: center;
            width: 100%;
        }
        
        nav a, nav div.notification-bell {
            padding: 0.6rem 1rem !important;
            font-size: 0.8rem !important;
            white-space: nowrap;
        }
        
        body > div > div[style*="grid-template-columns: repeat(3, 1fr)"] {
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 12px !important;
        }
        
        div[style*="grid-template-columns: repeat(4, 1fr)"] {
            grid-template-columns: repeat(2, 1fr) !important;
            padding: 0 1rem !important;
            gap: 1rem !important;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    
    @media (max-width: 768px) {
        body > div > div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
            max-width: 100% !important;
            padding: 0 1rem !important;
        }
        
        div[style*="grid-template-columns: repeat(4, 1fr)"] {
            grid-template-columns: 1fr !important;
            padding: 0 1rem !important;
        }
        
        body > div > div[style*="grid-template-columns"] > div {
            min-height: 120px !important;
            padding: 15px !important;
        }
        
        body > div > div[style*="grid-template-columns"] > div > div:nth-child(2) {
            font-size: 1.6em !important;
        }
        
        .admin-header h1 {
            font-size: 1.5em !important;
        }
        
        #notificationPanel {
            width: calc(100vw - 40px);
            right: 20px;
        }
        
        .agendamento-card {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .agendamento-card > div:last-child {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .row {
            flex-direction: column;
        }
        
        .col-half {
            width: 100% !important;
            margin-bottom: 20px;
        }
        
        canvas {
            width: 100% !important;
            height: auto !important;
        }
        
        /* GrÃ¡ficos responsivos */
        .row[style*="grid-template-columns: repeat(2, 1fr)"] {
            grid-template-columns: 1fr !important;
            padding: 0 1rem !important;
        }
        
        .stats-grid {
            grid-template-columns: 1fr !important;
            padding: 0 1rem !important;
        }
        
        nav {
            padding: 1rem !important;
        }
        
        nav > div {
            gap: 0.5rem !important;
        }
        
        nav a {
            font-size: 0.75rem !important;
            padding: 0.5rem 0.75rem !important;
        }
    }
    
    @media (max-width: 640px) {
        div[style*="padding: 0 2rem"] {
            padding: 0 1rem !important;
        }
        
        div[style*="max-width: 1400px"] {
            max-width: 100% !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
        
        nav > div > div:first-child span {
            font-size: 1rem !important;
        }
        
        nav > div > div:last-child {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 0.5rem !important;
            width: 100%;
        }
        
        nav a, nav div.notification-bell {
            width: 100%;
            justify-content: center;
        }
    }
    
    @media (max-width: 480px) {
        .admin-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .notification-bell {
            position: relative;
            top: auto;
            right: auto;
        }
        
        nav > div > div:last-child {
            grid-template-columns: 1fr !important;
        }
    }
    
    /* Responsividade dos cards de estatÃ­sticas */
    @media (max-width: 1200px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr !important;
            padding: 0 1rem !important;
        }
        
        /* Navbar mobile - scroll horizontal nos botÃµes */
        nav > div > div:last-child {
            display: flex !important;
            flex-wrap: nowrap !important;
            overflow-x: auto !important;
            gap: 0.5rem !important;
            padding: 0.5rem 0 !important;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        nav > div > div:last-child::-webkit-scrollbar {
            height: 4px;
        }
        
        nav > div > div:last-child::-webkit-scrollbar-thumb {
            background: rgba(74, 158, 255, 0.5);
            border-radius: 2px;
        }
        
        nav a, nav div.notification-bell {
            flex-shrink: 0;
            min-width: fit-content;
        }
    }

    @media (max-width: 768px) {
        .navbar-content {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start;
        }

        #mobileMenuBtn {
            display: block !important;
        }
        
        #desktopMenu {
            display: none !important;
        }
        
        .navbar-brand {
            font-size: 1.2rem;
        }
    }

    @media (min-width: 769px) {
        #mobileMenu {
            display: none !important;
        }
    }
    
    #mobileMenu {
        transition: all 0.3s ease;
    }
</style>

<!-- Painel de NotificaÃ§Ãµes -->
<div id="notificationPanel" style="display: none; position: fixed; top: 80px; right: 20px; width: 350px; max-width: calc(100vw - 40px); max-height: 400px; overflow-y: auto; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); backdrop-filter: blur(10px); z-index: 1000; padding: 20px; animation: slideIn 0.3s ease;">
    <h3 style="margin-top: 0; color: #4a9eff; font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700; letter-spacing: -0.5px;">ğŸ”” NotificaÃ§Ãµes</h3>
    <div id="notificationList">
        <p style="color: rgba(255, 255, 255, 0.6); text-align: center; font-family: 'Plus Jakarta Sans', sans-serif;">Nenhuma notificaÃ§Ã£o no momento</p>
    </div>
</div>

<!-- Cards de EstatÃ­sticas -->
<div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; max-width: 1400px; margin-left: auto; margin-right: auto; padding: 0 2rem;">
    <div style="background: rgba(74, 158, 255, 0.05); box-shadow: 0 4px 15px rgba(74, 158, 255, 0.1); padding: 1.5rem; border-radius: 16px; color: white; border: 1px solid rgba(74, 158, 255, 0.2); transition: all 0.3s ease; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(74, 158, 255, 0.2)'">
        <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Plus Jakarta Sans', sans-serif;">ğŸ‘¥ Total de Clientes</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #4a9eff; letter-spacing: -1px; font-family: 'Plus Jakarta Sans', sans-serif;">{{ usuarios|length }}</div>
        <a href="{{ url_for('clientes', slug=barbearia.slug) }}" style="color: #4a9eff !important; text-decoration: none; font-size: 0.85rem; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">Gerenciar â†’</a>
    </div>

    <div style="background: rgba(74, 158, 255, 0.05); box-shadow: 0 4px 15px rgba(74, 158, 255, 0.1); padding: 1.5rem; border-radius: 16px; color: white; border: 1px solid rgba(74, 158, 255, 0.2); transition: all 0.3s ease; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(74, 158, 255, 0.2)'">
        <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Plus Jakarta Sans', sans-serif;">âœ‚ï¸ ServiÃ§os Ativos</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #4a9eff; letter-spacing: -1px; font-family: 'Plus Jakarta Sans', sans-serif;">{{ servicos|length }}</div>
        <a href="{{ url_for('servicos', slug=barbearia.slug) }}" style="color: #4a9eff !important; text-decoration: none; font-size: 0.85rem; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">Gerenciar â†’</a>
    </div>

    <div style="background: rgba(74, 158, 255, 0.05); box-shadow: 0 4px 15px rgba(74, 158, 255, 0.1); padding: 1.5rem; border-radius: 16px; color: white; border: 1px solid rgba(74, 158, 255, 0.2); transition: all 0.3s ease; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(74, 158, 255, 0.2)'">
        <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Plus Jakarta Sans', sans-serif;">ğŸ’° Faturamento Hoje</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #4a9eff; letter-spacing: -1px; font-family: 'Plus Jakarta Sans', sans-serif;" id="faturamentoHoje">R$ 0</div>
        <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.8rem; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">Estimado</span>
    </div>
    
    <div style="background: rgba(74, 158, 255, 0.05); box-shadow: 0 4px 15px rgba(74, 158, 255, 0.1); padding: 1.5rem; border-radius: 16px; color: white; border: 1px solid rgba(74, 158, 255, 0.2); transition: all 0.3s ease; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(74, 158, 255, 0.2)'">
        <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-family: 'Plus Jakarta Sans', sans-serif;">â° Disponibilidade</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #4a9eff; letter-spacing: -0.5px; font-family: 'Plus Jakarta Sans', sans-serif;">HorÃ¡rios</div>
        <a href="{{ url_for('admin_disponibilidade', slug=barbearia.slug) }}" style="color: #4a9eff !important; text-decoration: none; font-size: 0.85rem; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">Configurar â†’</a>
    </div>
</div>

<!-- Agendamentos -->
<div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; max-width: 1400px; margin-left: auto; margin-right: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
        <h2 style="margin: 0; color: #4a9eff; font-size: 1.8rem; font-weight: 700; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.5px;">ğŸ“‹ Agendamentos</h2>
        <span id="dataHoje" style="color: rgba(255, 255, 255, 0.6); font-size: 0.95rem; font-family: 'Plus Jakarta Sans', sans-serif;"></span>
    </div>
    
    <!-- Filtros Modernos -->
    <div style="background: rgba(74, 158, 255, 0.05); border: 1px solid rgba(74, 158, 255, 0.15); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
        <!-- Linha 1: Filtros rÃ¡pidos -->
        <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <button onclick="aplicarFiltroRapido('hoje')" id="filtroHoje" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(74, 158, 255, 0.1); border: 1px solid #4a9eff; color: #4a9eff; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸ“… Hoje
            </button>
            <button onclick="aplicarFiltroRapido('amanha')" id="filtroAmanha" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(74, 158, 255, 0.2); color: rgba(255, 255, 255, 0.7); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸŒ… AmanhÃ£
            </button>
            <button onclick="aplicarFiltroRapido('semana')" id="filtroSemana" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(74, 158, 255, 0.2); color: rgba(255, 255, 255, 0.7); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸ“† Esta Semana
            </button>
            <button onclick="aplicarFiltroRapido('mes')" id="filtroMes" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(74, 158, 255, 0.2); color: rgba(255, 255, 255, 0.7); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸ—“ï¸ Este MÃªs
            </button>
            <button onclick="aplicarFiltroRapido('todos')" id="filtroTodos" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(74, 158, 255, 0.2); color: rgba(255, 255, 255, 0.7); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸŒ Todos
            </button>
            <button onclick="aplicarFiltroRapido('concluidos')" id="filtroConcluidos" class="filtro-btn" style="padding: 0.7rem 1.2rem; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(74, 158, 255, 0.2); color: rgba(255, 255, 255, 0.7); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                âœ… ConcluÃ­dos
            </button>
        </div>
        
        <!-- Linha 2: Busca e Status -->
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <input type="text" id="buscaCliente" placeholder="ğŸ” Buscar por nome do cliente..." onkeyup="aplicarFiltros()" style="flex: 1; min-width: 250px; padding: 0.8rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 8px; font-size: 0.9rem; transition: all 0.3s ease; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif;">
            
            <select id="filtroStatus" onchange="aplicarFiltros()" style="padding: 0.8rem 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: rgba(255, 255, 255, 0.9); font-family: 'Plus Jakarta Sans', sans-serif;">
                <option value="todos">Todos os Status</option>
                <option value="confirmada">âœ… Confirmadas</option>
                <option value="pendente">ğŸ•’ Pendentes</option>
            </select>
            
            <button onclick="limparFiltros()" style="padding: 0.8rem 1.2rem; background: rgba(255, 59, 48, 0.2); color: #ff3b30; border: 1px solid rgba(255, 59, 48, 0.3); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
                ğŸ—‘ï¸ Limpar
            </button>
        </div>
    </div>
    
    <!-- EstatÃ­sticas do Filtro -->
    <div id="estatisticasFiltro" style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
        <!-- Preenchido dinamicamente -->
    </div>
    
    <!-- Container Todos -->
    <div id="agendamentosTodosContainer">
        <div id="agendamentosTodos">
            <div style="text-align: center; padding: 40px; color: #94a3b8;">
                <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“‹</div>
                <p>Carregando agendamentos...</p>
            </div>
        </div>
    </div>
    
    <!-- PaginaÃ§Ã£o -->
    <div id="paginacao" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;">
        <!-- Preenchido dinamicamente -->
    </div>
</div>

<!-- GrÃ¡fico de Agendamentos da Semana -->
<div class="row" style="gap: 1.5rem; max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: repeat(2, 1fr); padding: 0 2rem;">
    <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 16px; padding: 2rem;">
        <h3 style="color: #4a9eff; font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.5px;">ğŸ“Š Agendamentos da Semana</h3>
        <canvas id="chartSemana" style="max-height: 300px;"></canvas>
    </div>

    <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 16px; padding: 2rem;">
        <h3 style="color: #4a9eff; font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.5px;">ğŸ† Top ServiÃ§os</h3>
        <div id="topServicos">
            {% if servicos %}
                {% for servico in servicos[:5] %}
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.2rem; background: rgba(74, 158, 255, 0.05); border: 1px solid rgba(74, 158, 255, 0.15); border-radius: 12px; margin-bottom: 0.75rem; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#4a9eff'; this.style.background='rgba(74, 158, 255, 0.1)'" onmouseout="this.style.borderColor='rgba(74, 158, 255, 0.15)'; this.style.background='rgba(74, 158, 255, 0.05)'">
                    <div>
                        <div style="font-weight: 700; color: #fff; font-size: 1rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">{{ servico.nome }}</div>
                        <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-top: 0.25rem; font-family: 'Plus Jakarta Sans', sans-serif;">{{ servico.duracao }}min</div>
                    </div>
                    <div style="font-weight: 800; color: #4a9eff; font-size: 1.3rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.5px;">R$ {{ "%.2f"|format(servico.preco) }}</div>
                </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: rgba(255, 255, 255, 0.5); padding: 2rem; font-family: 'Plus Jakarta Sans', sans-serif;">Nenhum serviÃ§o cadastrado</p>
            {% endif %}
        </div>
        </div>
    </div>
</div>

<script>
// Menu Mobile Toggle
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    const btn = document.getElementById('mobileMenuBtn');
    
    if (mobileMenu.style.display === 'none' || mobileMenu.style.display === '') {
        mobileMenu.style.display = 'block';
        btn.textContent = 'âœ•';
    } else {
        mobileMenu.style.display = 'none';
        btn.textContent = 'â˜°';
    }
}

// Data de hoje
document.getElementById('dataHoje').textContent = new Date().toLocaleDateString('pt-BR', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
});

// NotificaÃ§Ãµes
let notifications = [];

// FunÃ§Ã£o para tocar som de notificaÃ§Ã£o (funciona em todos os navegadores)
function tocarSomNotificacao() {
    try {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();
        
        // Criar oscilador para o som
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        // Configurar o som (tipo sino agradÃ¡vel)
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // FrequÃªncia alta (ding)
        oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
        
        // Configurar volume com fade out
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        // Tocar o som
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
        
        console.log('ğŸ”Š Som de notificaÃ§Ã£o tocado!');
    } catch (e) {
        console.log('âŒ Erro ao tocar som:', e);
        // Fallback: tentar com Ã¡udio HTML5
        try {
            const audio = new Audio('data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=');
            audio.play().catch(() => console.log('Som nÃ£o suportado'));
        } catch (e2) {
            console.log('Fallback de som tambÃ©m falhou');
        }
    }
}

function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    const btn = document.getElementById('mobileMenuBtn');
    
    if (mobileMenu.style.display === 'none' || mobileMenu.style.display === '') {
        mobileMenu.style.display = 'block';
        btn.textContent = 'âœ•';
    } else {
        mobileMenu.style.display = 'none';
        btn.textContent = 'â˜°';
    }
}

function toggleNotifications() {
    const panel = document.getElementById('notificationPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

function addNotification(message, type = 'info') {
    console.log('ğŸ”” Adicionando notificaÃ§Ã£o:', message, type);
    notifications.unshift({ message, type, time: new Date() });
    updateNotifications();
    
    // Tocar som
    tocarSomNotificacao();
    
    // Mostrar painel automaticamente para novas notificaÃ§Ãµes
    const panel = document.getElementById('notificationPanel');
    panel.style.display = 'block';
    
    // Auto-hide apÃ³s 8 segundos
    setTimeout(() => {
        if (panel.style.display === 'block') {
            panel.style.display = 'none';
        }
    }, 8000);
}

function updateNotifications() {
    const badge = document.getElementById('notifBadge');
    const list = document.getElementById('notificationList');
    
    console.log('ğŸ“Š Atualizando notificaÃ§Ãµes. Total:', notifications.length);
    console.log('ğŸ” Badge element encontrado:', badge);
    console.log('ğŸ” Badge current display:', badge ? badge.style.display : 'badge nÃ£o encontrado');
    
    if (notifications.length > 0) {
        // ForÃ§ar display com setProperty
        badge.style.setProperty('display', 'flex', 'important');
        badge.textContent = notifications.length;
        
        // Verificar se realmente estÃ¡ visÃ­vel
        console.log('âœ… Badge configurado - display:', badge.style.display);
        console.log('âœ… Badge textContent:', badge.textContent);
        console.log('âœ… Badge computed display:', window.getComputedStyle(badge).display);
        
        // Remover display: none inline se existir
        badge.removeAttribute('style');
        badge.style.display = 'flex';
        badge.textContent = notifications.length;
        
        console.log('âœ… Badge apÃ³s reset - display:', badge.style.display);
        
        list.innerHTML = notifications.map((n, i) => {
            const icon = n.type === 'success' ? 'âœ…' : n.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            const time = n.time.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            return `
                <div style="padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${n.type === 'success' ? '#10b981' : n.type === 'warning' ? '#f59e0b' : '#3b82f6'};">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <span style="font-size: 1.2em;">${icon}</span>
                        <div style="flex: 1;">
                            <div style="color: #1e293b; font-size: 0.9em;">${n.message}</div>
                            <div style="color: #94a3b8; font-size: 0.75em; margin-top: 5px;">${time}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    } else {
        badge.style.display = 'none';
        list.innerHTML = '<p style="color: #94a3b8; text-align: center;">Nenhuma notificaÃ§Ã£o</p>';
    }
}

// VariÃ¡vel global para controlar Ãºltimo nÃºmero de agendamentos
let ultimoNumeroAgendamentos = 0;
let idsAgendamentosVistos = new Set();
let primeiraVerificacao = true;

// VariÃ¡veis para filtros e paginaÃ§Ã£o
let todosAgendamentos = [];
let agendamentosFiltrados = [];
let paginaAtual = 1;
const itensPorPagina = 10;
let filtroAtivo = 'hoje'; // PadrÃ£o: hoje

// FunÃ§Ã£o para aplicar filtro rÃ¡pido
function aplicarFiltroRapido(tipo) {
    filtroAtivo = tipo;
    
    // Atualizar botÃµes visuais
    document.querySelectorAll('.filtro-btn').forEach(btn => {
        btn.classList.remove('ativo');
        btn.style.background = 'white';
        btn.style.color = '#64748b';
        btn.style.borderColor = '#e2e8f0';
    });
    
    const btnAtivo = document.getElementById(`filtro${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
    if (btnAtivo) {
        btnAtivo.classList.add('ativo');
    }
    
    paginaAtual = 1;
    aplicarFiltros();
}

// FunÃ§Ã£o principal de filtros
function aplicarFiltros() {
    console.log('ğŸ” Aplicando filtros... Total de agendamentos:', todosAgendamentos ? todosAgendamentos.length : 0);
    
    if (!todosAgendamentos || todosAgendamentos.length === 0) {
        console.log('âš ï¸ Nenhum agendamento para filtrar');
        agendamentosFiltrados = [];
        exibirAgendamentosPaginados();
        return;
    }
    
    const busca = document.getElementById('buscaCliente').value.toLowerCase();
    const status = document.getElementById('filtroStatus').value;
    
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    
    const amanha = new Date(hoje);
    amanha.setDate(amanha.getDate() + 1);
    
    const fimSemana = new Date(hoje);
    fimSemana.setDate(hoje.getDate() + (7 - hoje.getDay()));
    
    const fimMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
    
    // Aplicar filtros
    agendamentosFiltrados = todosAgendamentos.filter(r => {
        // Filtro de busca
        if (busca && !r.cliente_nome.toLowerCase().includes(busca)) {
            return false;
        }
        
        // Filtro de status
        if (status !== 'todos' && r.status !== status) {
            return false;
        }
        
        // Filtro de data
        const dataAgendamento = new Date(r.data + 'T00:00:00');
        dataAgendamento.setHours(0, 0, 0, 0);
        
        switch(filtroAtivo) {
            case 'hoje':
                return dataAgendamento.getTime() === hoje.getTime();
            case 'amanha':
                return dataAgendamento.getTime() === amanha.getTime();
            case 'semana':
                return dataAgendamento >= hoje && dataAgendamento <= fimSemana;
            case 'mes':
                return dataAgendamento >= hoje && dataAgendamento <= fimMes;
            case 'concluidos':
                return r.status === 'concluida';
            case 'todos':
                return r.status !== 'concluida';
            default:
                return true;
        }
    });
    
    exibirEstatisticas();
    renderizarPaginacao();
    exibirAgendamentosPaginados();
}

// Exibir estatÃ­sticas do filtro
function exibirEstatisticas() {
    const stats = document.getElementById('estatisticasFiltro');
    const total = agendamentosFiltrados.length;
    const confirmadas = agendamentosFiltrados.filter(r => r.status === 'confirmada').length;
    const pendentes = agendamentosFiltrados.filter(r => r.status === 'pendente').length;
    
    stats.innerHTML = `
        <div style="padding: 10px 15px; background: white; border-radius: 8px; border-left: 3px solid #3b82f6; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 1.2em;">ğŸ“Š</span>
            <div>
                <div style="font-size: 0.75em; color: #64748b;">Total</div>
                <div style="font-weight: bold; color: #1e293b;">${total}</div>
            </div>
        </div>
        <div style="padding: 10px 15px; background: white; border-radius: 8px; border-left: 3px solid #10b981; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 1.2em;">âœ…</span>
            <div>
                <div style="font-size: 0.75em; color: #64748b;">Confirmadas</div>
                <div style="font-weight: bold; color: #10b981;">${confirmadas}</div>
            </div>
        </div>
        <div style="padding: 10px 15px; background: white; border-radius: 8px; border-left: 3px solid #f59e0b; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 1.2em;">ğŸ•’</span>
            <div>
                <div style="font-size: 0.75em; color: #64748b;">Pendentes</div>
                <div style="font-weight: bold; color: #f59e0b;">${pendentes}</div>
            </div>
        </div>
    `;
}

// Renderizar paginaÃ§Ã£o
function renderizarPaginacao() {
    const totalPaginas = Math.ceil(agendamentosFiltrados.length / itensPorPagina);
    const paginacao = document.getElementById('paginacao');
    
    if (totalPaginas <= 1) {
        paginacao.innerHTML = '';
        return;
    }
    
    let html = '';
    
    // BotÃ£o anterior
    if (paginaAtual > 1) {
        html += `<button onclick="mudarPagina(${paginaAtual - 1})" style="padding: 0.75rem 1.25rem; background: rgba(74, 158, 255, 0.1); color: #4a9eff; border: 1px solid rgba(74, 158, 255, 0.3); border-radius: 10px; cursor: pointer; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(74, 158, 255, 0.2)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.background='rgba(74, 158, 255, 0.1)'; this.style.borderColor='rgba(74, 158, 255, 0.3)'">â† Anterior</button>`;
    }
    
    // NÃºmeros de pÃ¡gina
    for (let i = 1; i <= totalPaginas; i++) {
        if (i === 1 || i === totalPaginas || (i >= paginaAtual - 1 && i <= paginaAtual + 1)) {
            const ativo = i === paginaAtual;
            html += `<button onclick="mudarPagina(${i})" style="padding: 0.75rem 1.25rem; background: ${ativo ? 'rgba(74, 158, 255, 0.2)' : 'rgba(255, 255, 255, 0.03)'}; color: ${ativo ? '#4a9eff' : 'rgba(255, 255, 255, 0.7)'}; border: 1px solid ${ativo ? '#4a9eff' : 'rgba(74, 158, 255, 0.2)'}; border-radius: 10px; cursor: pointer; font-weight: ${ativo ? '700' : '500'}; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#4a9eff'" onmouseout="this.style.borderColor='${ativo ? '#4a9eff' : 'rgba(74, 158, 255, 0.2)'}'">${i}</button>`;
        } else if (i === paginaAtual - 2 || i === paginaAtual + 2) {
            html += '<span style="color: rgba(255, 255, 255, 0.4); font-family: \'Plus Jakarta Sans\', sans-serif;">...</span>';
        }
    }
    
    // BotÃ£o prÃ³ximo
    if (paginaAtual < totalPaginas) {
        html += `<button onclick="mudarPagina(${paginaAtual + 1})" style="padding: 0.75rem 1.25rem; background: rgba(74, 158, 255, 0.1); color: #4a9eff; border: 1px solid rgba(74, 158, 255, 0.3); border-radius: 10px; cursor: pointer; font-weight: 600; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(74, 158, 255, 0.2)'; this.style.borderColor='#4a9eff'" onmouseout="this.style.background='rgba(74, 158, 255, 0.1)'; this.style.borderColor='rgba(74, 158, 255, 0.3)'">PrÃ³ximo â†’</button>`;
    }
    
    paginacao.innerHTML = html;
}

// Mudar pÃ¡gina
function mudarPagina(pagina) {
    paginaAtual = pagina;
    exibirAgendamentosPaginados();
    renderizarPaginacao();
    
    // Scroll suave para o topo dos agendamentos
    document.getElementById('agendamentosTodosContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Exibir agendamentos paginados
function exibirAgendamentosPaginados() {
    const inicio = (paginaAtual - 1) * itensPorPagina;
    const fim = inicio + itensPorPagina;
    const agendamentosPagina = agendamentosFiltrados.slice(inicio, fim);
    
    const container = document.getElementById('agendamentosTodos');
    
    if (agendamentosPagina.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #94a3b8;">
                <div style="font-size: 3em; margin-bottom: 10px;">ğŸ”</div>
                <p>Nenhum agendamento encontrado com os filtros aplicados</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = renderizarAgendamentos(agendamentosPagina);
}

// Limpar todos os filtros
function limparFiltros() {
    document.getElementById('buscaCliente').value = '';
    document.getElementById('filtroStatus').value = 'todos';
    aplicarFiltroRapido('hoje');
}

// Renderizar cards de agendamentos
function renderizarAgendamentos(agendamentos) {
    return agendamentos.sort((a, b) => {
        const dataCompare = b.data.localeCompare(a.data);
        if (dataCompare !== 0) return dataCompare;
        return b.hora_inicio.localeCompare(a.hora_inicio);
    }).map(r => {
        const statusColor = r.status === 'confirmada' ? '#10b981' : r.status === 'cancelada' ? '#ef4444' : '#f59e0b';
        const statusIcon = r.status === 'confirmada' ? 'âœ…' : r.status === 'cancelada' ? 'âŒ' : 'ğŸ•’';
        
        // Definir cores especiais para clientes com plano
        const cardBorderColor = r.tem_plano ? '#fbbf24' : statusColor;
        const cardBgColor = r.tem_plano ? 'rgba(251, 191, 36, 0.05)' : 'rgba(255, 255, 255, 0.05)';
        const planoIcon = r.tem_plano ? 'â­' : '';
        
        // Formatar data
        const dataObj = new Date(r.data + 'T00:00:00');
        const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        
        return `
            <div class="agendamento-card" style="border-left: 4px solid ${cardBorderColor}; background: ${cardBgColor};">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 1.5em;">${statusIcon}</span>
                        <div>
                            <div style="font-weight: 600; color: #1e293b; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                                ğŸ‘¤ ${r.cliente_nome}
                                ${r.tem_plano ? `<span style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; padding: 3px 10px; border-radius: 12px; font-size: 0.7em; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);">â­ ${r.plano_nome}</span>` : ''}
                            </div>
                            <div style="color: #64748b; font-size: 0.85em;">ğŸ“ ${r.cliente_telefone}</div>
                            <div style="color: #64748b; font-size: 0.85em; margin-top: 4px;">${r.servico_nome || 'ServiÃ§o N/A'}</div>
                            <div style="color: #3b82f6; font-size: 0.85em; margin-top: 4px;">ğŸ“… ${dataFormatada}</div>
                        </div>
                    </div>
                </div>
                <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                    <div>
                        <div style="font-size: 1.3em; font-weight: bold; color: #3b82f6;">${r.hora_inicio}</div>
                        <div style="color: #64748b; font-size: 0.85em;">${r.servico_duracao || 30}min</div>
                        <div style="margin-top: 5px; padding: 4px 12px; background: ${statusColor}; color: white; border-radius: 20px; font-size: 0.75em; display: inline-block;">${r.status}</div>
                    </div>
                    ${r.status !== 'concluida' ? `
                    <button onclick="concluirAtendimentoDashboard('${r.uuid}', '${r.cliente_nome}')" 
                            style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 5px; margin-bottom: 4px;"
                            onmouseover="this.style.background='#059669'; this.style.transform='scale(1.05)'" 
                            onmouseout="this.style.background='#10b981'; this.style.transform='scale(1)'">
                        âœ… Concluir
                    </button>
                    ` : ''}
                    ${r.status !== 'concluida' && r.status !== 'cancelada' ? `
                    <button onclick="cancelarAgendamento('${r.uuid}', '${r.cliente_nome}')" 
                            style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 5px;"
                            onmouseover="this.style.background='#dc2626'; this.style.transform='scale(1.05)'" 
                            onmouseout="this.style.background='#ef4444'; this.style.transform='scale(1)'">
                        ğŸš« Cancelar
                    </button>
                    ` : ''}
                </div>
            </div>
        `;
    }).join('');
}

// Carregar todos os agendamentos
async function carregarTodosAgendamentos() {
    try {
        console.log('ğŸ”„ Carregando agendamentos...');
        const response = await fetch('{{ url_for("api_agendamentos_todos", slug=barbearia.slug) }}');
        
        console.log('ğŸ“¡ Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const agendamentos = await response.json();
        console.log('ğŸ“¥ Agendamentos recebidos:', agendamentos.length);
        
        // Verificar se Ã© um array vÃ¡lido
        if (!Array.isArray(agendamentos)) {
            console.error('âŒ Resposta nÃ£o Ã© um array:', agendamentos);
            throw new Error('Resposta invÃ¡lida da API');
        }
        
        console.log('ğŸ“Š UUIDs atuais no servidor:', agendamentos.map(a => a.uuid));
        console.log('ğŸ’¾ UUIDs jÃ¡ vistos:', Array.from(idsAgendamentosVistos));
        
        // Detectar novos agendamentos apÃ³s primeira carga
        if (!primeiraVerificacao) {
            console.log('ğŸ” Verificando novos agendamentos...');
            let novosDetectados = 0;
            
            agendamentos.forEach(agendamento => {
                const uuid = agendamento.uuid;
                const jaVisto = idsAgendamentosVistos.has(uuid);
                console.log(`  UUID ${uuid} - ${agendamento.cliente_nome}: ${jaVisto ? 'âœ… jÃ¡ visto' : 'ğŸ†• NOVO!'}`);
                
                if (!jaVisto) {
                    // Novo agendamento detectado!
                    novosDetectados++;
                    console.log('ğŸ‰ NOVO AGENDAMENTO DETECTADO:', agendamento);
                    const mensagem = `ğŸ‰ Novo agendamento: ${agendamento.cliente_nome} Ã s ${agendamento.hora_inicio}`;
                    console.log('ğŸ“¢ Chamando addNotification com:', mensagem);
                    addNotification(mensagem, 'success');
                    idsAgendamentosVistos.add(uuid);
                    
                    // Tocar som de notificaÃ§Ã£o usando Web Audio API
                    tocarSomNotificacao();
                }
            });
            
            console.log(`âœ… VerificaÃ§Ã£o completa: ${novosDetectados} novo(s) agendamento(s)`);
        } else {
            // Primeira carga - apenas marcar os UUIDs existentes
            console.log('ğŸ“‹ Primeira carga - marcando', agendamentos.length, 'agendamentos existentes');
            agendamentos.forEach(agendamento => {
                idsAgendamentosVistos.add(agendamento.uuid);
            });
            primeiraVerificacao = false;
            console.log('âœ… IDs iniciais marcados:', Array.from(idsAgendamentosVistos));
        }
        
        // Atualizar array global e aplicar filtros
        todosAgendamentos = agendamentos;
        
        // Se nÃ£o houver agendamentos, mostrar mensagem amigÃ¡vel
        if (agendamentos.length === 0) {
            const container = document.getElementById('agendamentosTodos');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #94a3b8;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“­</div>
                        <p>Nenhum agendamento encontrado</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Os agendamentos aparecerÃ£o aqui assim que forem criados.</p>
                    </div>
                `;
            }
        } else {
            aplicarFiltros();
        }
        
    } catch (error) {
        console.error('âŒ Erro ao carregar todos agendamentos:', error);
        const container = document.getElementById('agendamentosTodos');
        if (container) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #ef4444;">
                    <div style="font-size: 3em; margin-bottom: 10px;">âš ï¸</div>
                    <p>Erro ao carregar agendamentos</p>
                    <p style="font-size: 0.9em; color: #94a3b8; margin-top: 10px;">${error.message}</p>
                </div>
            `;
        }
    }
}

// Carregar agendamentos de hoje (apenas para atualizar o faturamento)
async function carregarAgendamentosHoje() {
    try {
        const response = await fetch('{{ url_for("api_agendamentos_hoje", slug=barbearia.slug) }}');
        if (!response.ok) {
            console.error('Erro na resposta da API:', response.status);
            throw new Error('Erro ao buscar agendamentos');
        }
        
        const agendamentosHoje = await response.json();
        console.log('Agendamentos de hoje recebidos:', agendamentosHoje.length, agendamentosHoje);
        
        // Verificar se hÃ¡ novos agendamentos
        if (ultimoNumeroAgendamentos > 0 && agendamentosHoje.length > ultimoNumeroAgendamentos) {
            const novos = agendamentosHoje.length - ultimoNumeroAgendamentos;
            addNotification(`ğŸ‰ ${novos} novo(s) agendamento(s)!`, 'success');
        }
        ultimoNumeroAgendamentos = agendamentosHoje.length;
        
        // Calcular faturamento
        let faturamento = 0;
        agendamentosHoje.forEach(r => {
            faturamento += r.servico_preco || 0;
        });
        document.getElementById('faturamentoHoje').textContent = `R$ ${faturamento.toFixed(2)}`;
    } catch (error) {
        console.error('Erro ao carregar agendamentos de hoje:', error);
    }
}

// GrÃ¡fico da semana com dados reais
function criarGraficoSemana() {
    const canvas = document.getElementById('chartSemana');
    const ctx = canvas.getContext('2d');
    
    // Pegar dados reais das reservas
    const reservas = [
        {% for r in reservas %}
        {
            data: "{{ r.data }}",
            status: "{{ r.status }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];
    
    // Calcular agendamentos por dia da semana (Ãºltimos 7 dias)
    const hoje = new Date();
    const dias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];
    const dadosSemana = [0, 0, 0, 0, 0, 0, 0];
    
    // Contar agendamentos dos Ãºltimos 7 dias
    for (let i = 6; i >= 0; i--) {
        const data = new Date(hoje);
        data.setDate(data.getDate() - i);
        const dataStr = data.toISOString().split('T')[0];
        const diaSemana = data.getDay();
        
        const count = reservas.filter(r => r.data === dataStr && r.status !== 'cancelada').length;
        dadosSemana[diaSemana] += count;
    }
    
    // Redesenhar canvas
    canvas.width = canvas.offsetWidth;
    canvas.height = 300;
    
    const maxValue = Math.max(...dadosSemana, 1);
    const barWidth = (canvas.width / 7) - 20;
    const barSpacing = 10;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    dadosSemana.forEach((valor, i) => {
        const barHeight = (valor / maxValue) * (canvas.height - 60);
        const x = i * (barWidth + barSpacing) + barSpacing;
        const y = canvas.height - barHeight - 40;
        
        // Barra com gradiente
        const gradient = ctx.createLinearGradient(0, y, 0, canvas.height);
        gradient.addColorStop(0, '#3b82f6');
        gradient.addColorStop(1, '#06b6d4');
        ctx.fillStyle = gradient;
        ctx.roundRect = function(x, y, w, h, r) {
            if (w < 2 * r) r = w / 2;
            if (h < 2 * r) r = h / 2;
            this.beginPath();
            this.moveTo(x+r, y);
            this.arcTo(x+w, y, x+w, y+h, r);
            this.arcTo(x+w, y+h, x, y+h, r);
            this.arcTo(x, y+h, x, y, r);
            this.arcTo(x, y, x+w, y, r);
            this.closePath();
            return this;
        };
        ctx.roundRect(x, y, barWidth, barHeight, 8);
        ctx.fill();
        
        // Valor no topo
        ctx.fillStyle = '#1e293b';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(valor, x + barWidth / 2, y - 10);
        
        // Dia da semana
        ctx.fillStyle = '#64748b';
        ctx.font = '13px Arial';
        ctx.fillText(dias[i], x + barWidth / 2, canvas.height - 15);
    });
    
    // TÃ­tulo do grÃ¡fico
    ctx.fillStyle = '#1e293b';
    ctx.font = 'bold 14px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('Agendamentos por dia da semana (Ãºltimos 7 dias)', 10, 20);
}

// Inicializar
document.addEventListener('DOMContentLoaded', () => {
    carregarAgendamentosHoje();
    carregarTodosAgendamentos(); // Carregar todos os agendamentos na inicializaÃ§Ã£o
    criarGraficoSemana();
    
    // NotificaÃ§Ã£o de boas-vindas removida para evitar mensagens automÃ¡ticas no login
    
    // Recarregar a cada 10 segundos para notificaÃ§Ãµes em tempo real
    setInterval(() => {
        carregarAgendamentosHoje();
        carregarTodosAgendamentos();
    }, 5000); // Reduzido para 5 segundos para detecÃ§Ã£o mais rÃ¡pida
});

// FunÃ§Ã£o para cancelar agendamento
async function cancelarAgendamento(reservaId, clienteNome) {
    if (!confirm(`Tem certeza que deseja cancelar o agendamento de ${clienteNome}?`)) {
        return;
    }
    
    try {
        const response = await fetch(`{{ url_for('admin_cancelar_agendamento', slug=barbearia.slug, reserva_uuid='PLACEHOLDER') }}`.replace('PLACEHOLDER', reservaId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            addNotification(`âœ… ${data.message}`, 'success');
            // Recarregar agendamentos imediatamente
            carregarAgendamentosHoje();
            carregarTodosAgendamentos();
        } else {
            addNotification(`âŒ ${data.message}`, 'error');
        }
    } catch (error) {
        console.error('Erro ao cancelar:', error);
        addNotification('âŒ Erro ao cancelar agendamento', 'error');
    }
}

// FunÃ§Ã£o para concluir atendimento no dashboard
async function concluirAtendimentoDashboard(reservaId, clienteNome) {
    if (!confirm(`Confirmar conclusÃ£o do atendimento de ${clienteNome}?`)) {
        return;
    }
    
    try {
        const response = await fetch(`{{ url_for('admin_concluir_atendimento', slug=barbearia.slug, reserva_uuid='PLACEHOLDER') }}`.replace('PLACEHOLDER', reservaId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            addNotification(`âœ… ${data.message}`, 'success');
            // Recarregar agendamentos imediatamente
            carregarAgendamentosHoje();
            carregarTodosAgendamentos();
        } else {
            addNotification(`âŒ ${data.message}`, 'error');
        }
    } catch (error) {
        console.error('Erro ao concluir atendimento:', error);
        addNotification('âŒ Erro ao concluir atendimento', 'error');
    }
}

// Fechar notificaÃ§Ãµes ao clicar fora
document.addEventListener('click', (e) => {
    const panel = document.getElementById('notificationPanel');
    const bell = document.querySelector('.notification-bell');
    if (panel.style.display === 'block' && !panel.contains(e.target) && !bell.contains(e.target)) {
        panel.style.display = 'none';
    }
});
</script>

<footer style="background: rgba(255, 255, 255, 0.03); border-top: 1px solid rgba(74, 158, 255, 0.2); padding: 2rem; text-align: center; margin-top: 4rem;">
    <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.3px;">
        Desenvolvido por <span style="color: #4a9eff; font-weight: 700;">BarberConnect</span> âœ‚ï¸
    </p>
</footer>

</body>
</html>